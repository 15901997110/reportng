<?xml version="1.0" encoding="UTF-8"?>
<project name="reportng-maven" default="package" xmlns:artifact="urn:maven-artifact-ant">

  <import file="build.xml"/>

  <property name="maven.repository.url" value="http://download.java.net/maven/2/" />
  <!-- Repository user name and password must be passed in on the command line for
       privacy reasons.  The properties are "maven.user" and "maven.password". -->

  <typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="urn:maven-artifact-ant"
           classpath="${basedir}/lib/maven-ant-tasks-2.0.8.jar" />

  <target name="init">
    <artifact:remoteRepository id="maven.repository"
                               url="${maven.repository.url}">
      <authentication username="${maven.user}" password="${maven.password}"/>
    </artifact:remoteRepository>
    <copy file="${basedir}/reportng.pom" tofile="${build.dir}/reportng.pom">
      <filterset>
        <filter token="VERSION" value="${version}"/>
      </filterset>
    </copy>
    <artifact:pom id="reportng.pom" file="${build.dir}/reportng.pom" />
  </target>

  <!-- adds the maven pom to the jar. -->
  <target name="package" depends="init, jar, jar-source, jar-javadocs, jar-test-source">
    <copy file="${build.dir}/reportng.pom"
          tofile="${classes.dir}/main/META-INF/maven/org/uncommons/reportng/${artifact.identifier}.pom"/>
    <jar update="true" jarfile="${build.dir}/${artifact.identifier}.jar">
      <fileset dir="${classes.dir}/main" >
        <include name="**/*.pom" />
      </fileset>
    </jar>
  </target>

  <target name="jar-source">
    <jar jarfile="${build.dir}/${artifact.identifier}-sources.jar">
      <fileset dir="${java.dir}/main"/>
      <fileset dir="${templates.dir}"/>
    </jar>
  </target>

  <target name="jar-test-source">
    <jar jarfile="${build.dir}/${artifact.identifier}-test-sources.jar">
      <fileset dir="${java.dir}/test"/>
    </jar>
  </target>

  <target name="jar-javadocs" depends="docs">
    <jar jarfile="${build.dir}/${artifact.identifier}-javadoc.jar">
      <fileset dir="${api.dir}"/>
    </jar>
  </target>

  <target name="install" depends="init, package">
    <artifact:install file="${build.dir}/${artifact.identifier}.jar">
      <pom refid="reportng.pom"/>
      <attach file="${build.dir}/${artifact.identifier}-sources.jar" type="jar" classifier="sources"/>
      <attach file="${build.dir}/${artifact.identifier}-javadoc.jar" type="jar" classifier="javadoc"/>
      <attach file="${build.dir}/${artifact.identifier}-test-sources.jar" type="jar" classifier="test-sources"/>
    </artifact:install>
  </target>

  <target name="deploy" depends="init, package">
    <artifact:deploy file="${build.dir}/${artifact.identifier}.jar">
      <remoteRepository refid="maven.repository.id"/>
      <pom refid="reportng.pom"/>
      <attach file="${build.dir}/${artifact.identifier}-sources.jar" type="jar" classifier="sources"/>
      <attach file="${build.dir}/${artifact.identifier}-javadoc.jar" type="jar" classifier="javadoc"/>
      <attach file="${build.dir}/${artifact.identifier}-test-sources.jar" type="jar" classifier="test-sources"/>
    </artifact:deploy>
  </target>

</project>